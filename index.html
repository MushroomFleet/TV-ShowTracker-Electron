<!DOCTYPE html>
<html lang="en" x-data="{}" :class="{ 'dark': $store.darkMode.enabled }">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Progress Tracker</title>
  <!-- Tailwind CSS via CDN with configuration -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // Add custom colors here if needed
          }
        }
      }
    }
  </script>
  <!-- Alpine.js via CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Font Awesome via CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Alpine.js Stores for Dark Mode and Minimal Mode -->
  <script>
    document.addEventListener('alpine:init', () => {
      // Dark Mode Store
      Alpine.store('darkMode', {
        enabled: localStorage.getItem('darkMode') === 'true',
        toggle() {
          this.enabled = !this.enabled;
          localStorage.setItem('darkMode', this.enabled);
        }
      });
      
      // Active Tab Store
      Alpine.store('activeTab', {
        current: localStorage.getItem('activeTab') || 'track',
        previous: localStorage.getItem('previousTab') || 'track',
        set(tab) {
          this.previous = this.current;
          this.current = tab;
          localStorage.setItem('activeTab', tab);
          localStorage.setItem('previousTab', this.previous);
        }
      });
      
      // Minimal Mode Store
      Alpine.store('minimalMode', {
        enabled: localStorage.getItem('minimalMode') === 'true',
        async toggle() {
          if (!this.enabled) {
            // Entering minimal mode: save current tab and switch to watching
            Alpine.store('activeTab').previous = Alpine.store('activeTab').current;
            localStorage.setItem('previousTab', Alpine.store('activeTab').previous);
            Alpine.store('activeTab').current = 'watching';
            localStorage.setItem('activeTab', 'watching');
          } else {
            // Exiting minimal mode: restore previous tab
            Alpine.store('activeTab').current = Alpine.store('activeTab').previous;
            localStorage.setItem('activeTab', Alpine.store('activeTab').current);
          }
          
          this.enabled = !this.enabled;
          localStorage.setItem('minimalMode', this.enabled);
          
          // Sync with Electron to adjust window size
          try {
            await window.electronAPI.setMinimalMode(this.enabled);
          } catch (error) {
            console.error('Error syncing minimal mode with main process:', error);
          }
        }
      });
      
      // Apply dark mode on page load if it's enabled in localStorage
      if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      
      // Initialize app settings from the main process
      const initAppSettings = async () => {
        try {
          const settings = await window.electronAPI.getAppSettings();
          
          // Sync minimal mode with main process settings
          if (settings.minimalMode !== Alpine.store('minimalMode').enabled) {
            Alpine.store('minimalMode').enabled = settings.minimalMode;
            localStorage.setItem('minimalMode', settings.minimalMode);
          }
        } catch (error) {
          console.error('Error loading app settings:', error);
        }
      };
      
      // Initialize settings after Alpine is ready
      initAppSettings();
    });
  </script>
  
  <style>
    [x-cloak] { display: none !important; }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    
    /* Animations */
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .slide-in {
      animation: slideIn 0.3s ease-in-out;
    }
    
    @keyframes slideIn {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen text-gray-800 dark:text-gray-200 transition-colors duration-200">
  <div 
    x-data="tvShowTracker()" 
    x-init="init()" 
    class="container mx-auto p-4 transition-all duration-300"
    :class="{'max-w-6xl': !$store.minimalMode.enabled, 'max-w-3xl': $store.minimalMode.enabled}"
  >
    <header class="mb-6 relative" :class="{'text-center': !$store.minimalMode.enabled}">
      <div class="absolute right-0 top-0 flex space-x-2 z-10">
        <!-- Minimal Mode Toggle -->
        <button 
          @click="$store.minimalMode.toggle()" 
          class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
          aria-label="Toggle minimal mode"
          :title="$store.minimalMode.enabled ? 'Exit minimal view' : 'Enter minimal view'"
        >
          <i class="fas" :class="$store.minimalMode.enabled ? 'fa-expand' : 'fa-compress'"></i>
        </button>
        
        <!-- Dark Mode Toggle -->
        <button 
          @click="$store.darkMode.toggle()" 
          class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          <i class="fas" :class="$store.darkMode.enabled ? 'fa-sun' : 'fa-moon'"></i>
        </button>
      </div>
      
      <!-- App Title & Description - Hidden in Minimal Mode -->
      <div x-show="!$store.minimalMode.enabled" class="fade-in">
        <h1 class="text-3xl font-bold text-indigo-700 dark:text-indigo-400 mb-2">
          <i class="fas fa-bookmark mr-2"></i>Media Progress Tracker
        </h1>
        <p class="text-gray-600 dark:text-gray-300">Keep track of your favorite TV shows, comics, and books</p>
      </div>
      
      <!-- Minimal Mode Indicator - Only shown in minimal view with a more subtle design -->
      <div 
        x-show="$store.minimalMode.enabled" 
        class="bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 text-xs py-1 px-2 rounded-md inline-block opacity-80 mb-2"
      >
        <i class="fas fa-eye mr-1"></i> Currently Watching
      </div>
    </header>
    
    <!-- Tab Navigation - Hidden in Minimal Mode -->
    <div x-show="!$store.minimalMode.enabled" class="bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6 transition-colors duration-200 fade-in">
      <nav class="flex flex-wrap border-b dark:border-gray-700">
        <button 
          @click="$store.activeTab.set('track')" 
          :class="{ 
            'border-indigo-500 text-indigo-600 dark:text-indigo-400': $store.activeTab.current === 'track', 
            'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200': $store.activeTab.current !== 'track'
          }"
          class="flex items-center justify-center px-4 py-3 text-center border-b-2 font-medium text-sm sm:text-base transition-all duration-200 ease-in-out"
        >
          <i class="fas fa-edit mr-2"></i> <span>Track Progress</span>
        </button>
        <button 
          @click="$store.activeTab.set('watching')" 
          :class="{ 
            'border-indigo-500 text-indigo-600 dark:text-indigo-400': $store.activeTab.current === 'watching', 
            'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200': $store.activeTab.current !== 'watching'
          }"
          class="flex items-center justify-center px-4 py-3 text-center border-b-2 font-medium text-sm sm:text-base transition-all duration-200 ease-in-out"
        >
          <i class="fas fa-eye mr-2"></i> <span>Currently Watching</span>
        </button>
        <button 
          @click="$store.activeTab.set('backup')" 
          :class="{ 
            'border-indigo-500 text-indigo-600 dark:text-indigo-400': $store.activeTab.current === 'backup', 
            'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200': $store.activeTab.current !== 'backup'
          }"
          class="flex items-center justify-center px-4 py-3 text-center border-b-2 font-medium text-sm sm:text-base transition-all duration-200 ease-in-out"
        >
          <i class="fas fa-save mr-2"></i> <span>Backup Management</span>
        </button>
      </nav>
    </div>
    
    <!-- Content Area -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md transition-colors duration-200"
         :class="{'p-6': !$store.minimalMode.enabled, 'p-3 sm:p-4': $store.minimalMode.enabled}">
      <!-- Track Progress Tab - Hidden in Minimal Mode -->
<div x-show="!$store.minimalMode.enabled && $store.activeTab.current === 'track'" class="fade-in">
        <h2 class="text-xl font-semibold mb-4 text-indigo-700 dark:text-indigo-400"><i class="fas fa-edit mr-2"></i>Track Media Progress</h2>
        
        <!-- Media Type Selection -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Media Type</label>
          <div class="flex flex-wrap gap-4">
            <label class="inline-flex items-center">
              <input 
                type="radio" 
                x-model="newShow.mediaType" 
                value="tv-show" 
                class="form-radio text-indigo-600 focus:ring-indigo-500 h-4 w-4"
              >
              <span class="ml-2"><i class="fas fa-tv text-gray-500 mr-1"></i>TV Show</span>
            </label>
            <label class="inline-flex items-center">
              <input 
                type="radio" 
                x-model="newShow.mediaType" 
                value="comic" 
                class="form-radio text-indigo-600 focus:ring-indigo-500 h-4 w-4"
              >
              <span class="ml-2"><i class="fas fa-book-open text-gray-500 mr-1"></i>Comic</span>
            </label>
            <label class="inline-flex items-center">
              <input 
                type="radio" 
                x-model="newShow.mediaType" 
                value="book" 
                class="form-radio text-indigo-600 focus:ring-indigo-500 h-4 w-4"
              >
              <span class="ml-2"><i class="fas fa-book text-gray-500 mr-1"></i>Book</span>
            </label>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="show-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="getMediaNameLabel()"></label>
          <input 
            type="text" 
            id="show-name" 
            x-model="newShow.name" 
            :placeholder="'Enter the name of your ' + getMediaTypeName()" 
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          >
        </div>
        
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label for="season" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="getSeasonLabel()"></label>
            <div class="flex items-center">
              <input 
                type="number" 
                id="season" 
                x-model.number="newShow.season" 
                min="1"
                class="w-20 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
              >
              <div class="flex flex-col ml-1">
                <button 
                  @click="newShow.season++" 
                  class="h-6 px-2 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-t border border-gray-300 dark:border-gray-600 dark:text-gray-200"
                  :title="'Increase ' + getSeasonLabel().toLowerCase()"
                >
                  <i class="fas fa-chevron-up"></i>
                </button>
                <button 
                  @click="newShow.season > 1 ? newShow.season-- : null" 
                  class="h-6 px-2 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-b border border-gray-300 dark:border-gray-600 border-t-0 dark:text-gray-200"
                  :title="'Decrease ' + getSeasonLabel().toLowerCase()"
                >
                  <i class="fas fa-chevron-down"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div>
            <label for="episode" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" x-text="getEpisodeLabel()"></label>
            <div class="flex items-center">
              <input 
                type="number" 
                id="episode" 
                x-model.number="newShow.episode" 
                min="1"
                class="w-20 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
              >
              <div class="flex flex-col ml-1">
                <button 
                  @click="newShow.episode++" 
                  class="h-6 px-2 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-t border border-gray-300 dark:border-gray-600 dark:text-gray-200"
                  :title="'Increase ' + getEpisodeLabel().toLowerCase()"
                >
                  <i class="fas fa-chevron-up"></i>
                </button>
                <button 
                  @click="newShow.episode > 1 ? newShow.episode-- : null" 
                  class="h-6 px-2 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 rounded-b border border-gray-300 dark:border-gray-600 border-t-0 dark:text-gray-200"
                  :title="'Decrease ' + getEpisodeLabel().toLowerCase()"
                >
                  <i class="fas fa-chevron-down"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Notes (optional)</label>
          <textarea 
            id="notes" 
            x-model="newShow.notes" 
            placeholder="Add any notes about the show or episode..." 
            rows="3" 
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
          ></textarea>
        </div>
        
        <button 
          @click="trackShow()" 
          class="px-4 py-2 bg-indigo-600 dark:bg-indigo-700 text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors duration-200"
        >
          <i class="fas fa-save mr-2"></i>Track Progress
        </button>
        
        <div 
          x-show="statusMessage.track" 
          x-text="statusMessage.track" 
          :class="{
            'bg-green-100 dark:bg-green-900 border-green-400 dark:border-green-700 text-green-700 dark:text-green-300': !statusMessage.track.includes('‚ö†Ô∏è'), 
            'bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300': statusMessage.track.includes('‚ö†Ô∏è')
          }" 
          class="mt-4 p-3 border-l-4 rounded-md"
        ></div>
      </div>
      
      <!-- Currently Watching Tab - Always shown in Minimal Mode -->
      <div x-show="$store.activeTab.current === 'watching' || $store.minimalMode.enabled" class="fade-in">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-indigo-700 dark:text-indigo-400"><i class="fas fa-eye mr-2"></i>Currently Watching</h2>
          <button 
            @click="refreshWatchList()" 
            class="px-3 py-1 bg-indigo-100 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-300 rounded-md hover:bg-indigo-200 dark:hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors duration-200"
          >
            <i class="fas fa-sync-alt mr-1"></i>Refresh
          </button>
        </div>
        
        <div 
          class="bg-gray-50 dark:bg-gray-700 rounded-md overflow-y-auto transition-all duration-300" 
          :class="{
            'p-4 max-h-96 mb-6': !$store.minimalMode.enabled,
            'p-2 max-h-[calc(100vh-250px)] mb-3': $store.minimalMode.enabled
          }"
        >
          <template x-if="Object.keys(tvShows).length === 0">
            <div class="text-gray-500 text-center py-8">
              <i class="fas fa-inbox text-4xl mb-2 block"></i>
              <p>You are not currently watching any shows.</p>
            </div>
          </template>
          
          <template x-for="(progress, show) in sortedShows" :key="show">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-3 slide-in transition-all duration-300"
                 :class="{'p-4': !$store.minimalMode.enabled, 'p-2 sm:p-3': $store.minimalMode.enabled}">
              <div class="flex flex-col">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <h3 class="font-semibold dark:text-gray-200 transition-all duration-300"
                        :class="{'text-lg': !$store.minimalMode.enabled, 'text-base': $store.minimalMode.enabled}"
                        x-html="getShowEmoji(progress) + ' ' + show"></h3>
                    <p class="text-gray-700 dark:text-gray-300"
                       :class="{'text-sm': $store.minimalMode.enabled}">
                      <span x-text="getMediaSeasonLabel(progress)"></span> <span x-text="progress.Season"></span>, 
                      <span x-text="getMediaEpisodeLabel(progress)"></span> <span x-text="progress.Episode"></span>
                    </p>
                    <template x-if="progress.Notes && !$store.minimalMode.enabled">
                      <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                        <p class="font-medium mb-1"><i class="fas fa-sticky-note mr-1"></i>Notes:</p>
                        <p x-html="formatNotes(progress.Notes)"></p>
                      </div>
                    </template>
                    <!-- In minimal mode, show notes as a tooltip/expandable section -->
                    <template x-if="progress.Notes && $store.minimalMode.enabled">
                      <div class="mt-1">
                        <button 
                          @click="showNotesModal = showNotesModal === show ? null : show"
                          class="text-xs text-indigo-500 hover:text-indigo-700 dark:text-indigo-400 focus:outline-none flex items-center"
                        >
                          <i class="fas fa-sticky-note mr-1"></i> View notes
                        </button>
                      </div>
                    </template>
                  </div>
                  <button 
                    @click="confirmDeleteShow(show)" 
                    class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 focus:outline-none"
                    title="Delete show"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
                
                <!-- Quick Edit Controls -->
                <div class="quick-edit-controls flex items-center gap-2 mt-2 bg-gray-50 dark:bg-gray-700 rounded-md transition-all duration-300"
                     :class="{'p-2': !$store.minimalMode.enabled, 'p-1': $store.minimalMode.enabled}">
                  <button 
                    @click="quickDecrementEpisode(show)" 
                    class="bg-gray-200 dark:bg-gray-600 rounded-full h-8 w-8 flex items-center justify-center hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors duration-150 dark:text-gray-200"
                    title="Previous episode"
                  >
                    <i class="fas fa-minus text-sm"></i>
                  </button>
                  
                  <button 
                    @click="quickIncrementEpisode(show)" 
                    class="bg-indigo-500 dark:bg-indigo-600 rounded-full h-8 w-8 flex items-center justify-center text-white hover:bg-indigo-600 dark:hover:bg-indigo-700 transition-colors duration-150"
                    title="Next episode"
                  >
                    <i class="fas fa-plus text-sm"></i>
                  </button>
                  
                  <button 
                    @click="nextSeason(show)" 
                    class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-xs hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors duration-150 ml-1 dark:text-gray-200"
                    title="Next season"
                  >
                    <i class="fas fa-step-forward mr-1"></i>Next Season
                  </button>
                  
                  <span 
                    x-show="updateMessages[show]" 
                    x-text="updateMessages[show]" 
                    class="text-xs text-green-600 ml-2 fade-in"
                    x-effect="if(updateMessages[show]) { setTimeout(() => { updateMessages[show] = '' }, 3000) }"
                  ></span>
                </div>
              </div>
            </div>
          </template>
        </div>
        
        <!-- Notes Modal -->
        <div 
          x-show="showNotesModal" 
          x-cloak
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
        >
          <div 
            @click.away="showNotesModal = null"
            class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 max-w-md w-full"
          >
            <div class="flex justify-between items-center mb-3">
              <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200">Notes</h3>
              <button 
                @click="showNotesModal = null" 
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="text-gray-700 dark:text-gray-300">
              <template x-if="showNotesModal && tvShows[showNotesModal]">
                <div x-html="formatNotes(tvShows[showNotesModal].Notes)"></div>
              </template>
            </div>
          </div>
        </div>
      
        <!-- Website link at the bottom of the viewing list -->
        <div class="mt-4 pt-3 text-center">
          <a 
            href="#" 
            @click.prevent="openExternalLink('https://www.scuffedepoch.com')" 
            class="text-xs text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-200"
          >
            www.scuffedepoch.com
          </a>
        </div>
        
        <div 
          x-show="statusMessage.delete" 
          x-text="statusMessage.delete" 
          :class="{
            'bg-green-100 dark:bg-green-900 border-green-400 dark:border-green-700 text-green-700 dark:text-green-300': !statusMessage.delete.includes('‚ö†Ô∏è') && !statusMessage.delete.includes('‚ùå'), 
            'bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300': statusMessage.delete.includes('‚ö†Ô∏è') || statusMessage.delete.includes('‚ùå')
          }" 
          class="mt-4 p-3 border-l-4 rounded-md"
        ></div>
      </div>
      
      <!-- Backup Management Tab - Hidden in Minimal Mode -->
      <div x-show="!$store.minimalMode.enabled && $store.activeTab.current === 'backup'" class="fade-in">
        <h2 class="text-xl font-semibold mb-4 text-indigo-700 dark:text-indigo-400"><i class="fas fa-save mr-2"></i>Backup Management</h2>
        
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-5 mb-6">
          <h3 class="text-lg font-medium mb-3 text-gray-700 dark:text-gray-300"><i class="fas fa-download mr-2"></i>Create Backup</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">Create a backup of your current media progress.</p>
          <button 
            @click="createBackup()" 
            class="px-4 py-2 bg-indigo-600 dark:bg-indigo-700 text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors duration-200"
          >
            <i class="fas fa-save mr-2"></i>Create Backup
          </button>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-5">
          <h3 class="text-lg font-medium mb-3 text-gray-700 dark:text-gray-300"><i class="fas fa-upload mr-2"></i>Restore from Backup</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-2">Import a previously created backup file.</p>
          <p class="text-yellow-700 dark:text-yellow-500 mb-4 text-sm"><i class="fas fa-exclamation-triangle mr-1"></i>Note: Importing a backup will replace your current data. A backup of your current data will be created automatically.</p>
          
          <button 
            @click="selectBackupFile()" 
            class="px-4 py-2 bg-indigo-600 dark:bg-indigo-700 text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition-colors duration-200"
          >
            <i class="fas fa-file-import mr-2"></i>Select Backup File
          </button>
        </div>
        
        <div 
          x-show="statusMessage.backup" 
          x-text="statusMessage.backup" 
          :class="{
            'bg-green-100 dark:bg-green-900 border-green-400 dark:border-green-700 text-green-700 dark:text-green-300': !statusMessage.backup.includes('‚ö†Ô∏è') && !statusMessage.backup.includes('‚ùå'), 
            'bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300': statusMessage.backup.includes('‚ö†Ô∏è') || statusMessage.backup.includes('‚ùå')
          }" 
          class="mt-4 p-3 border-l-4 rounded-md"
        ></div>
      </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div 
      x-show="showDeleteModal" 
      x-cloak
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    >
      <div 
        @click.away="showDeleteModal = false"
        class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full"
      >
        <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">Confirm Deletion</h3>
        <p class="mb-6 text-gray-700 dark:text-gray-300">Are you sure you want to remove "<span x-text="confirmShowName" class="font-semibold"></span>" from your watch list?</p>
        <div class="flex justify-end space-x-3">
          <button 
            @click="showDeleteModal = false" 
            class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition-colors duration-200"
          >
            Cancel
          </button>
          <button 
            @click="confirmDelete()" 
            class="px-4 py-2 bg-red-600 dark:bg-red-700 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-colors duration-200"
          >
            <i class="fas fa-trash mr-2"></i>Delete
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    function tvShowTracker() {
      return {
        // Use computed properties to sync with Alpine's global stores
        get activeTab() {
          return Alpine.store('activeTab').current;
        },
        set activeTab(value) {
          Alpine.store('activeTab').set(value);
        },
        tvShows: {},
        newShow: {
          name: '',
          mediaType: 'tv-show', // Default to TV Show
          season: 1,
          episode: 1,
          notes: ''
        },
        deleteShowName: '',
        confirmShowName: '',
        showDeleteModal: false,
        showNotesModal: null, // For viewing notes in minimal mode
        statusMessage: {
          track: '',
          delete: '',
          backup: ''
        },
        updateMessages: {}, // For quick edit feedback messages
        
        async init() {
          try {
            this.tvShows = await window.electronAPI.loadProgress();
          } catch (error) {
            console.error('Error loading TV show data:', error);
          }
        },
        
        get sortedShows() {
          // Sort shows alphabetically
          return Object.keys(this.tvShows)
            .sort()
            .reduce((obj, key) => {
              obj[key] = this.tvShows[key];
              return obj;
            }, {});
        },
        
        // Media type helper functions
        getMediaTypeName() {
          const mediaTypes = {
            'tv-show': 'TV Show',
            'comic': 'Comic',
            'book': 'Book'
          };
          return mediaTypes[this.newShow.mediaType] || 'TV Show';
        },
        
        getMediaNameLabel() {
          const labels = {
            'tv-show': 'TV Show Name',
            'comic': 'Comic Title',
            'book': 'Book Title'
          };
          return labels[this.newShow.mediaType] || 'Name';
        },
        
        getSeasonLabel() {
          const labels = {
            'tv-show': 'Season',
            'comic': 'Issue',
            'book': 'Volume'
          };
          return labels[this.newShow.mediaType] || 'Season';
        },
        
        getEpisodeLabel() {
          const labels = {
            'tv-show': 'Episode',
            'comic': 'Page',
            'book': 'Page'
          };
          return labels[this.newShow.mediaType] || 'Episode';
        },
        
        getMediaSeasonLabel(progress) {
          const mediaType = progress.MediaType || 'tv-show'; // Default to tv-show for backward compatibility
          const labels = {
            'tv-show': 'Season',
            'comic': 'Issue',
            'book': 'Volume'
          };
          return labels[mediaType] || 'Season';
        },
        
        getMediaEpisodeLabel(progress) {
          const mediaType = progress.MediaType || 'tv-show'; // Default to tv-show for backward compatibility
          const labels = {
            'tv-show': 'Episode',
            'comic': 'Page',
            'book': 'Page'
          };
          return labels[mediaType] || 'Episode';
        },
        
        getShowEmoji(progress) {
          // Add emoji based on progress and media type
          const mediaType = progress.MediaType || 'tv-show'; // Default to tv-show for backward compatibility
          
          if (progress.Season === 1 && progress.Episode <= 3) {
            return mediaType === 'tv-show' ? 'üÜï' : 
                   mediaType === 'comic' ? 'üìñ' : 
                   mediaType === 'book' ? 'üìö' : 'üÜï';
          } else if (progress.Season >= 3) {
            return mediaType === 'tv-show' ? 'üåü' : 
                   mediaType === 'comic' ? 'üîñ' : 
                   mediaType === 'book' ? 'üìö' : 'üåü';
          }
          
          return mediaType === 'tv-show' ? 'üé¨' : 
                 mediaType === 'comic' ? 'üìñ' : 
                 mediaType === 'book' ? 'üìï' : 'üé¨';
        },
        
        formatNotes(notes) {
          // Handle notes with URL detection and use Electron to open external URLs
          const urlPattern = /(https?:\/\/[^\s]+)/g;
          return notes.replace(urlPattern, '<a href="#" @click.prevent="openExternalLink(\'$1\')" class="text-indigo-600 hover:underline flex items-center"><i class="fas fa-external-link-alt text-xs mr-1"></i>$1</a>');
        },
        
        async openExternalLink(url) {
          try {
            await window.electronAPI.openExternalUrl(url);
          } catch (error) {
            console.error('Error opening external URL:', error);
          }
        },
        
        async trackShow() {
          if (!this.newShow.name.trim()) {
            this.statusMessage.track = '‚ö†Ô∏è Please enter a valid name!';
            return;
          }
          
          try {
            const result = await window.electronAPI.trackShow({
              name: this.newShow.name.trim(),
              season: this.newShow.season,
              episode: this.newShow.episode,
              notes: this.newShow.notes,
              mediaType: this.newShow.mediaType // Add mediaType
            });
            
            this.statusMessage.track = result.message;
            
            // Reset form fields
            this.newShow.name = '';
            
            // Refresh the show list
            this.tvShows = await window.electronAPI.loadProgress();
            
          } catch (error) {
            console.error('Error tracking media:', error);
            this.statusMessage.track = `‚ö†Ô∏è Error tracking media: ${error.message || 'Unknown error'}`;
          }
        },
        
        async refreshWatchList() {
          try {
            this.tvShows = await window.electronAPI.loadProgress();
          } catch (error) {
            console.error('Error refreshing watch list:', error);
          }
        },
        
        confirmDeleteShow(showName) {
          this.confirmShowName = showName;
          this.showDeleteModal = true;
        },
        
        async confirmDelete() {
          await this.performDelete(this.confirmShowName);
          this.showDeleteModal = false;
          this.confirmShowName = '';
        },
        
        async deleteShow() {
          if (!this.deleteShowName.trim()) {
            this.statusMessage.delete = '‚ö†Ô∏è Please enter a show name to delete!';
            return;
          }
          
          await this.performDelete(this.deleteShowName.trim());
          this.deleteShowName = '';
        },
        
        async performDelete(showName) {
          try {
            const result = await window.electronAPI.deleteShow(showName);
            this.statusMessage.delete = result.message;
            
            if (result.success) {
              // Refresh the show list
              this.tvShows = await window.electronAPI.loadProgress();
            }
          } catch (error) {
            console.error('Error deleting show:', error);
            this.statusMessage.delete = `‚ö†Ô∏è Error deleting show: ${error.message || 'Unknown error'}`;
          }
        },
        
        async createBackup() {
          try {
            const result = await window.electronAPI.createBackup();
            
            if (result.success) {
              this.statusMessage.backup = `üíæ Backup saved successfully as ${result.file.split('\\').pop().split('/').pop()} üéâ`;
            } else {
              this.statusMessage.backup = `‚ö†Ô∏è Error creating backup: ${result.error}`;
            }
          } catch (error) {
            console.error('Error creating backup:', error);
            this.statusMessage.backup = `‚ö†Ô∏è Error creating backup: ${error.message || 'Unknown error'}`;
          }
        },
        
        async selectBackupFile() {
          try {
            const result = await window.electronAPI.selectBackupFile();
            
            if (result.canceled) {
              return;
            }
            
            const importResult = await window.electronAPI.importBackup(result.filePath);
            this.statusMessage.backup = importResult.message;
            
            if (importResult.success) {
              // Refresh the show list
              this.tvShows = await window.electronAPI.loadProgress();
            }
          } catch (error) {
            console.error('Error importing backup:', error);
            this.statusMessage.backup = `‚ö†Ô∏è Error importing backup: ${error.message || 'Unknown error'}`;
          }
        },
        
        // Quick episode increment
        async quickIncrementEpisode(showName) {
          try {
            const show = this.tvShows[showName];
            if (!show) return;
            
            // Include mediaType in the update
            const result = await window.electronAPI.trackShow({
              name: showName,
              season: show.Season,
              episode: show.Episode + 1,
              notes: show.Notes,
              mediaType: show.MediaType || 'tv-show' // Preserve media type, default to tv-show
            });
            
            if (result.success) {
              // Refresh the show list
              this.tvShows = await window.electronAPI.loadProgress();
              
              // Get the appropriate labels for the success message
              const seasonLabel = this.getMediaSeasonLabel(show);
              const episodeLabel = this.getMediaEpisodeLabel(show);
              
              // Show temporary success message with proper labels
              this.updateMessages[showName] = `‚úì Updated to ${seasonLabel} ${show.Season}, ${episodeLabel} ${show.Episode + 1}`;
            }
          } catch (error) {
            console.error('Error updating episode:', error);
          }
        },
        
        // Quick episode decrement
        async quickDecrementEpisode(showName) {
          try {
            const show = this.tvShows[showName];
            if (!show || show.Episode <= 1) return;
            
            // Include mediaType in the update
            const result = await window.electronAPI.trackShow({
              name: showName,
              season: show.Season,
              episode: show.Episode - 1,
              notes: show.Notes,
              mediaType: show.MediaType || 'tv-show' // Preserve media type, default to tv-show
            });
            
            if (result.success) {
              // Refresh the show list
              this.tvShows = await window.electronAPI.loadProgress();
              
              // Get the appropriate labels for the success message
              const seasonLabel = this.getMediaSeasonLabel(show);
              const episodeLabel = this.getMediaEpisodeLabel(show);
              
              // Show temporary success message with proper labels
              this.updateMessages[showName] = `‚úì Updated to ${seasonLabel} ${show.Season}, ${episodeLabel} ${show.Episode - 1}`;
            }
          } catch (error) {
            console.error('Error updating episode:', error);
          }
        },
        
        // Next season
        async nextSeason(showName) {
          try {
            const show = this.tvShows[showName];
            if (!show) return;
            
            // Include mediaType in the update
            const result = await window.electronAPI.trackShow({
              name: showName,
              season: show.Season + 1,
              episode: 1, // Reset episode to 1
              notes: show.Notes,
              mediaType: show.MediaType || 'tv-show' // Preserve media type, default to tv-show
            });
            
            if (result.success) {
              // Refresh the show list
              this.tvShows = await window.electronAPI.loadProgress();
              
              // Get the appropriate label for the success message
              const seasonLabel = this.getMediaSeasonLabel(show);
              
              // Show temporary success message with proper label
              this.updateMessages[showName] = `‚úì Started ${seasonLabel} ${show.Season + 1}`;
            }
          } catch (error) {
            console.error('Error updating season:', error);
          }
        }
      };
    }
  </script>
</body>
</html>
